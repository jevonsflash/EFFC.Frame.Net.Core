(function(e){var t={initTree:function(t){var r=e.extend({},this.treegrid.defaults,t);return this.each(function(){var t=e(this);t.treegrid("setTreeContainer",e(this));t.treegrid("setSettings",r);r.getRootNodes.apply(this,[e(this)]).treegrid("initNode",r);t.treegrid("getRootNodes").treegrid("render")})},initNode:function(t){return this.each(function(){var r=e(this);r.treegrid("setTreeContainer",t.getTreeGridContainer.apply(this));r.treegrid("getChildNodes").treegrid("initNode",t);r.treegrid("initExpander").treegrid("initIndent").treegrid("initEvents").treegrid("initState").treegrid("initChangeEvent").treegrid("initSettingsEvents")})},initChangeEvent:function(){var t=e(this);t.on("change",function(){var t=e(this);t.treegrid("render");if(t.treegrid("getSetting","saveState")){t.treegrid("saveState")}});return t},initEvents:function(){var t=e(this);t.on("collapse",function(){var t=e(this);t.removeClass("treegrid-expanded");t.addClass("treegrid-collapsed")});t.on("expand",function(){var t=e(this);t.removeClass("treegrid-collapsed");t.addClass("treegrid-expanded")});return t},initSettingsEvents:function(){var t=e(this);t.on("change",function(){var t=e(this);if(typeof t.treegrid("getSetting","onChange")==="function"){t.treegrid("getSetting","onChange").apply(t)}});t.on("collapse",function(){var t=e(this);if(typeof t.treegrid("getSetting","onCollapse")==="function"){t.treegrid("getSetting","onCollapse").apply(t)}});t.on("expand",function(){var t=e(this);if(typeof t.treegrid("getSetting","onExpand")==="function"){t.treegrid("getSetting","onExpand").apply(t)}});return t},initExpander:function(){var t=e(this);var r=t.find("td").get(t.treegrid("getSetting","treeColumn"));var i=t.treegrid("getSetting","expanderTemplate");var n=t.treegrid("getSetting","getExpander").apply(this);if(n){n.remove()}e(i).prependTo(r).click(function(){e(e(this).closest("tr")).treegrid("toggle")});return t},initIndent:function(){var t=e(this);t.find(".treegrid-indent").remove();var r=t.treegrid("getSetting","indentTemplate");var i=t.find(".treegrid-expander");var n=t.treegrid("getDepth");for(var d=0;d<n;d++){e(r).insertBefore(i)}return t},initState:function(){var t=e(this);if(t.treegrid("getSetting","saveState")&&!t.treegrid("isFirstInit")){t.treegrid("restoreState")}else{if(t.treegrid("getSetting","initialState")==="expanded"){t.treegrid("expand")}else{t.treegrid("collapse")}}return t},isFirstInit:function(){var t=e(this).treegrid("getTreeContainer");if(t.data("first_init")===undefined){t.data("first_init",e.cookie(t.treegrid("getSetting","saveStateName"))===undefined)}return t.data("first_init")},saveState:function(){var t=e(this);if(t.treegrid("getSetting","saveStateMethod")==="cookie"){var r=e.cookie(t.treegrid("getSetting","saveStateName"))||"";var i=r===""?[]:r.split(",");var n=t.treegrid("getNodeId");if(t.treegrid("isExpanded")){if(e.inArray(n,i)===-1){i.push(n)}}else if(t.treegrid("isCollapsed")){if(e.inArray(n,i)!==-1){i.splice(e.inArray(n,i),1)}}e.cookie(t.treegrid("getSetting","saveStateName"),i.join(","))}return t},restoreState:function(){var t=e(this);if(t.treegrid("getSetting","saveStateMethod")==="cookie"){var r=e.cookie(t.treegrid("getSetting","saveStateName")).split(",");if(e.inArray(t.treegrid("getNodeId"),r)!==-1){t.treegrid("expand")}else{t.treegrid("collapse")}}return t},getSetting:function(t){if(!e(this).treegrid("getTreeContainer")){return null}return e(this).treegrid("getTreeContainer").data("settings")[t]},setSettings:function(t){e(this).treegrid("getTreeContainer").data("settings",t)},getTreeContainer:function(){return e(this).data("treegrid")},setTreeContainer:function(t){return e(this).data("treegrid",t)},getRootNodes:function(){return e(this).treegrid("getSetting","getRootNodes").apply(this,[e(this).treegrid("getTreeContainer")])},getAllNodes:function(){return e(this).treegrid("getSetting","getAllNodes").apply(this,[e(this).treegrid("getTreeContainer")])},isNode:function(){return e(this).treegrid("getNodeId")!==null},getNodeId:function(){if(e(this).treegrid("getSetting","getNodeId")===null){return null}else{return e(this).treegrid("getSetting","getNodeId").apply(this)}},getParentNodeId:function(){return e(this).treegrid("getSetting","getParentNodeId").apply(this)},getParentNode:function(){if(e(this).treegrid("getParentNodeId")===null){return null}else{return e(this).treegrid("getSetting","getNodeById").apply(this,[e(this).treegrid("getParentNodeId"),e(this).treegrid("getTreeContainer")])}},getChildNodes:function(){return e(this).treegrid("getSetting","getChildNodes").apply(this,[e(this).treegrid("getNodeId"),e(this).treegrid("getTreeContainer")])},getDepth:function(){if(e(this).treegrid("getParentNode")===null){return 0}return e(this).treegrid("getParentNode").treegrid("getDepth")+1},isRoot:function(){return e(this).treegrid("getDepth")===0},isLeaf:function(){return e(this).treegrid("getChildNodes").length===0},isLast:function(){if(e(this).treegrid("isNode")){var t=e(this).treegrid("getParentNode");if(t===null){if(e(this).treegrid("getNodeId")===e(this).treegrid("getRootNodes").last().treegrid("getNodeId")){return true}}else{if(e(this).treegrid("getNodeId")===t.treegrid("getChildNodes").last().treegrid("getNodeId")){return true}}}return false},isFirst:function(){if(e(this).treegrid("isNode")){var t=e(this).treegrid("getParentNode");if(t===null){if(e(this).treegrid("getNodeId")===e(this).treegrid("getRootNodes").first().treegrid("getNodeId")){return true}}else{if(e(this).treegrid("getNodeId")===t.treegrid("getChildNodes").first().treegrid("getNodeId")){return true}}}return false},isExpanded:function(){return e(this).hasClass("treegrid-expanded")},isCollapsed:function(){return e(this).hasClass("treegrid-collapsed")},isOneOfParentsCollapsed:function(){var t=e(this);if(t.treegrid("isRoot")){return false}else{if(t.treegrid("getParentNode").treegrid("isCollapsed")){return true}else{return t.treegrid("getParentNode").treegrid("isOneOfParentsCollapsed")}}},expand:function(){if(!this.treegrid("isLeaf")&&!this.treegrid("isExpanded")){this.trigger("expand");this.trigger("change");return this}return this},expandAll:function(){var t=e(this);t.treegrid("getRootNodes").treegrid("expandRecursive");return t},expandRecursive:function(){return e(this).each(function(){var t=e(this);t.treegrid("expand");if(!t.treegrid("isLeaf")){t.treegrid("getChildNodes").treegrid("expandRecursive")}})},collapse:function(){return e(this).each(function(){var t=e(this);if(!t.treegrid("isLeaf")&&!t.treegrid("isCollapsed")){t.trigger("collapse");t.trigger("change")}})},collapseAll:function(){var t=e(this);t.treegrid("getRootNodes").treegrid("collapseRecursive");return t},collapseRecursive:function(){return e(this).each(function(){var t=e(this);t.treegrid("collapse");if(!t.treegrid("isLeaf")){t.treegrid("getChildNodes").treegrid("collapseRecursive")}})},toggle:function(){var t=e(this);if(t.treegrid("isExpanded")){t.treegrid("collapse")}else{t.treegrid("expand")}return t},render:function(){return e(this).each(function(){var t=e(this);if(t.treegrid("isOneOfParentsCollapsed")){t.hide()}else{t.show()}if(!t.treegrid("isLeaf")){t.treegrid("renderExpander");t.treegrid("getChildNodes").treegrid("render")}})},renderExpander:function(){return e(this).each(function(){var t=e(this);var r=t.treegrid("getSetting","getExpander").apply(this);if(r){if(!t.treegrid("isCollapsed")){r.removeClass(t.treegrid("getSetting","expanderCollapsedClass"));r.addClass(t.treegrid("getSetting","expanderExpandedClass"))}else{r.removeClass(t.treegrid("getSetting","expanderExpandedClass"));r.addClass(t.treegrid("getSetting","expanderCollapsedClass"))}}else{t.treegrid("initExpander");t.treegrid("renderExpander")}})}};e.fn.treegrid=function(r){if(t[r]){return t[r].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof r==="object"||!r){return t.initTree.apply(this,arguments)}else{e.error("Method with name "+r+" does not exists for jQuery.treegrid")}};e.fn.treegrid.defaults={initialState:"expanded",saveState:false,saveStateMethod:"cookie",saveStateName:"tree-grid-state",expanderTemplate:'<span class="treegrid-expander"></span>',indentTemplate:'<span class="treegrid-indent"></span>',expanderExpandedClass:"treegrid-expander-expanded",expanderCollapsedClass:"treegrid-expander-collapsed",treeColumn:0,getExpander:function(){return e(this).find(".treegrid-expander")},getNodeId:function(){var t=/treegrid-([A-Za-z0-9_-]+)/;if(t.test(e(this).attr("class"))){return t.exec(e(this).attr("class"))[1]}return null},getParentNodeId:function(){var t=/treegrid-parent-([A-Za-z0-9_-]+)/;if(t.test(e(this).attr("class"))){return t.exec(e(this).attr("class"))[1]}return null},getNodeById:function(e,t){var r="treegrid-"+e;return t.find("tr."+r)},getChildNodes:function(e,t){var r="treegrid-parent-"+e;return t.find("tr."+r)},getTreeGridContainer:function(){return e(this).closest("table")},getRootNodes:function(t){var r=e.grep(t.find("tr"),function(t){var r=e(t).attr("class");var i=/treegrid-([A-Za-z0-9_-]+)/;var n=/treegrid-parent-([A-Za-z0-9_-]+)/;return i.test(r)&&!n.test(r)});return e(r)},getAllNodes:function(t){var r=e.grep(t.find("tr"),function(t){var r=e(t).attr("class");var i=/treegrid-([A-Za-z0-9_-]+)/;return i.test(r)});return e(r)},onCollapse:null,onExpand:null,onChange:null}})(jQuery);