(function(t,e){String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"gm"),e)};var i,n;Node=function(){function e(t,e,i){this.nid=t;this.pid=e;this.id=i;this.row=null;if(i==null){this.id=this.nid}this.id=i;this.childNodes=[];this.childDics={};this.parentNode=null;this.level=-1;this.Level=function(){return this.level}}e.prototype.AddChild=function(t){var e=this;this.childNodes.push(t);this.childDics[t.nid]=t;t.parentNode=e;return this};e.prototype.ChildNodes=function(){return this.childNodes};e.prototype.HasChild=function(){return this.childNodes.length>0};e.prototype.IsLeaf=function(){return!this.HasChild()};e.prototype.ChildNode=function(t){return this.childDics[t]};e.prototype.ChildNodeAt=function(t){return this.childNodes[t]};e.prototype.EachCHild=function(e,i){return t.each(this.childNodes,e,i)};return e}();Tree=function(){function e(t,e){this.table=t;this.settings=e;this.rowTag=this.settings.rowTag;this.nodeidname=this.settings.nodeIdAttr;this.pidname=this.settings.parentIdAttr;this.rootid=this.settings.rootId;this.initialState=this.settings.initialState;this.subnodeOffset=this.settings.subnodeOffset;this.openTemplate=this.settings.openTemplate;this.closeTempate=this.settings.closeTempate;this.leafTemplate=this.settings.leafTemplate;this.onExpandState=this.settings.onExpandState;this.onCollapseState=this.settings.onCollapseState;this.onStateChange=this.settings.onStateChange;this.onLoad=this.settings.onLoad;this.onLoadComplete=this.settings.onLoadComplete;this.nodedics={};this.arrnodes=[];this.rootnode=null;this.treedeep=0;this.deepdics=[]}e.prototype._buildtree=function(){var e=this;var i=t("#"+e.rootid);if(i==null)return;e.rootnode=new Node(i.attr(e.nodeidname),"",e.rootid);e.rootnode.level=0;e.rootnode.row=t("#"+e.rootid);t(this.table).find(this.rowTag+"["+e.nodeidname+"]").each(function(i,n){var o=t(this);if(o.attr("id")==e.rootid)return;var a=o.attr(e.nodeidname);var r=o.attr(e.pidname);var d=new String(o.attr("id")).replaceAll(" ","_");if(d==null||typeof d=="undefined"||d=="undefined"){d=a.replaceAll(" ","_");o.attr("id",d)}var s=new Node(a,r,d);s.row=o;o.remove();e.nodedics[a]=s;e.arrnodes[e.arrnodes.length]=s;if(r==e.rootnode.nid){e.rootnode.AddChild(s)}});for(var n in e.arrnodes){var o=e.arrnodes[n];var a=o.pid;var r=o.nid;var d=o.id;if(a!=e.rootnode.nid){e.nodedics[a].AddChild(o)}}e._levelc(e.rootnode);for(var n in e.arrnodes){var o=e.arrnodes[n];if(o.Level()>e.treedeep){e.treedeep=o.Level()}}};e.prototype._levelc=function(t){var e=this;if(t.pid!=""&&t.pid!=null){t.level=t.parentNode.level+1}var i=t;t.EachCHild(function(t,e){this.row.insertAfter(i.row);i=this});t.EachCHild(function(t,i){e._levelc(this)})};e.prototype.Load=function(){var e=this;e._buildtree();if(e.arrnodes.length>0){if(e.initialState=="Expand"){e.ExpandAll()}else{e.CollapseAll()}}if(e.onLoad!=null){var i={};i.obj=t("#"+e.rootid);i.parentobj=null;i.childobjs=[];e.rootnode.EachCHild(function(e,n){i.childobjs[e]=t(this.id)});i.nid=e.rootnode.nid;i.pid=e.rootnode.pid;i.isRoot=true;i.isLeaf=e.rootnode.IsLeaf();e.onLoad(i);for(var n in e.arrnodes){var o=e.arrnodes[n];i={};i.obj=t("#"+o.id);i.parentobj=t("#"+o.parentNode.id);i.childobjs=[];e.n.EachCHild(function(e,n){i.childobjs[e]=t(this.id)});i.nid=o.nid;i.pid=o.pid;i.isRoot=false;i.isLeaf=o.IsLeaf();e.onLoadComplete(i)}}if(e.onLoadComplete!=null){e.onLoadComplete(e)}};e.prototype.Node=function(t){if(t==this.rootnode.nid){return this.rootnode}else{return this.nodedics[t]}};e.prototype.RenderNode=function(e,i){if(!i)i=true;var n=this;var o=n.Node(e);var a=t("#"+o.id);var r=a.find("[treeclick='true']");if(o.id==n.rootid){r.css("margin-left","0px")}else{var d=t("#"+o.parentNode.id);var s=d.find("[treeclick='true']").css("margin-left");var l=s==null||s==""?parseInt(n.subnodeOffset):parseInt(String.prototype.replace.apply(s,["px",""]))+parseInt(n.subnodeOffset);var h=l+"px";r.css("margin-left",h)}if(i){if(o.HasChild()){var p=o.ChildNodes();for(var f in p){var c=p[f];n.RenderNode(c.nid)}}}};e.prototype._ExpandNode=function(e){var i=this;var n=i.Node(e);var o=t("#"+n.id);o.attr("childExpanded","true");var a=n.IsLeaf();if(i.onStateChange!=null){var r=i.onStateChange(o,true,a);i.RenderNode(e,false);if(!a){t(r).click(function(){i.Collapse(e)})}}};e.prototype.Expand=function(t){var e=this;e._ExpandNode(t);e.ExpandChild(t)};e.prototype.ExpandChild=function(e){var i=this;var n=i.Node(e);n.EachCHild(function(n,o){var a=t("#"+this.id);var r=this.IsLeaf();if(i.onExpandState){i.onExpandState(a)}if(i.onStateChange!=null){var d;var s=this.nid;if(a.attr("childExpanded")!="false"){d=i.onStateChange(a,true,r);t(d).click(function(){if(!r){i.Collapse(s)}})}else{d=i.onStateChange(a,false,r);t(d).click(function(){if(!r){i.Expand(s)}})}i.RenderNode(e,false)}if(!r){if(a.attr("childExpanded")!="false"){i.ExpandChild(this.nid)}else{i.CollapseChild(this.nid)}}})};e.prototype.ExpandToLevel=function(t){var e=this;if(t<=0){e.CollapseAll()}else{e.ExpandAll();for(var i=t;i<e.treedeep+1;i++){for(var n in e.arrnodes){var o=e.arrnodes[n];if(o.Level()==i){e.Collapse(o.nid)}}}}};e.prototype.ExpandAll=function(){var e=this;t("#"+this.rootnode.id).attr("childExpanded","true");for(var i in this.arrnodes){var n=this.arrnodes[i];if(n.HasChild()){t("#"+n.id).attr("childExpanded","true")}}e.Expand(this.rootnode.nid)};e.prototype._CollapseNode=function(e){var i=this;var n=i.Node(e);var o=n.IsLeaf();var a=t("#"+n.id);a.attr("childExpanded","false");if(i.onStateChange!=null){var r=i.onStateChange(a,false,o);if(!o){t(r).click(function(){i.Expand(e)})}i.RenderNode(e,false)}};e.prototype.Collapse=function(t){var e=this;e._CollapseNode(t);e.CollapseChild(t)};e.prototype.CollapseChild=function(e){var i=this;var n=i.Node(e);n.EachCHild(function(e,n){var o=t("#"+this.id);var a=this.IsLeaf();if(i.onCollapseState!=null){i.onCollapseState(o)}if(i.onStateChange!=null){var r;var d=this.nid;if(o.attr("childExpanded")!="false"){r=i.onStateChange(o,true,a);t(r).click(function(){if(!a){i.Collapse(d)}})}else{r=i.onStateChange(o,false,a);t(r).click(function(){if(!a){i.Expand(d)}})}i.RenderNode(this.nid,false)}i.CollapseChild(this.nid)})};e.prototype.CollapseToLevel=function(t){var e=this;for(var i in e.arrnodes){var n=e.arrnodes[i];if(n.n.Level()==t){e.Collapse(n.nid)}}};e.prototype.CollapseAll=function(){var e=this;t("#"+this.rootnode.id).attr("childExpanded","false");for(var i in this.arrnodes){var n=this.arrnodes[i];if(n.HasChild()){t("#"+n.id).attr("childExpanded","false")}}e.Collapse(this.rootnode.nid)};e.prototype.HasChildNode=function(t){var e=this;return e.Node(t).HasChild()};return e}();i={init:function(e,i){var n,o,e;this.table=e;n=t.extend({openTemplate:"<a href='#'>&nbsp;-&nbsp;</a>",closeTempate:"<a href='#'>&nbsp;+&nbsp;</a>",leafTemplate:"<span></span>",rowTag:"tr",nodeIdAttr:"nid",parentIdAttr:"pid",rootId:"root",initialState:"collapsed",subnodeOffset:"10",onExpandState:function(e){if(e){t(e).show()}},onCollapseState:function(e){if(e){t(e).hide()}},onStateChange:function(e,i,n){var o=this;if(e){var a=t(e).find("[treeclick='true']");var r=t(o.openTemplate).attr("treeclick","true");if(n){r=t(o.leafTemplate).attr("treeclick","true")}else{if(i){r=t(o.openTemplate).attr("treeclick","true")}else{r=t(o.closeTempate).attr("treeclick","true")}}a.replaceWith(r);return r}},onLoad:null,onLoadComplete:null},i);var a=this;o=new Tree(a.table,n);o.Load();t(this).data("treetable",o);return this},Expand:function(e){t(this).data("treetable").Expand(e);return this},ExpandAll:function(){t(this).data("treetable").ExpandAll();return this},ExpandToLevel:function(e){t(this).data("treetable").ExpandToLevel(e);return this},Collapse:function(e){t(this).data("treetable").Collapse(e);return this},CollapseAll:function(){t(this).data("treetable").CollapseAll();return this},CollapseToLevel:function(e){t(this).data("treetable").CollapseToLevel(e);return this},Destory:function(){}};t.fn.treetable=function(t){return i.init(this,t)}})(jQuery,FrameNameSpace);